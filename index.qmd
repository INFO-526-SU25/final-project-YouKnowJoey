---
title: "Graphically Pawsitive Vibes"
subtitle: "INFO 526 - Summer 2025 - Final Project"
author: 
  - name: "Isle of Dogs"
    affiliations:
      - name: "School of Information, University of Arizona"
description: "This project will graphically depict trends, patterns, and analysis of Animal Shelter data derived from the TidyTuesday initiative. The dataset includes information about animals taken in and released from the shelter; there are variables such as intake type, outcome type, animal type, breed, age, and more. The primary goal of this project is to identify key factors that influence an animals outcome."
format:
   html:
    code-tools: true
    code-overflow: wrap
    embed-resources: true
editor: visual
execute:
  warning: false
  echo: false
---

```{r}
#| label: load-pkgs
#| message: false
#| echo: false

if (!require("pacman")) 
  install.packages("pacman")

pacman::p_load(tidyverse,
               tidytuesdayR,
               formattable,
               dlookr,
               ggplot2,
               scales,
               lubridate,
               RColorBrewer)
```

# Graphically Pawsitive Vibes

## Abstract

This project examines factors influencing animal outcomes and adoption timelines at the Long Beach Animal Shelter. The dataset—sourced from TidyTuesday—contains 29,787 records and 22 fields, capturing intake and outcome events for various species in Long Beach, California.

The first goal investigates how intake conditions, species grouping, and age at intake relate to final outcomes. The raw data are cleaned and transformed by parsing the `dob` field into a numeric `age_at_intake`, standardizing `intake_condition` values, and collapsing `animal_type`. Visual analyses reveal which intake conditions are associated with more favorable outcomes, how outcome patterns differ across species groups, and whether age correlates with specific dispositions. These insights may help shelter staff identify high‐risk subgroups and allocate medical or foster resources more effectively.

The second goal analyzes time‐to‐adoption trends from 2021 through 2025. Records with `outcome_type == "adoption"` are filtered, `days_to_adoption` is computed as the difference between `outcome_date` and `intake_date`, and `intake_year` is derived. Visualizations illustrate how adoption lengths have shifted over time. This highlights whether animals find homes more quickly in recent years and identifies factors that drive those improvements. These findings could inform capacity planning, guide medical staffing decisions for long‐stay cases, and serve as benchmarks for continuous improvement in shelter performance.

## Introduction

The Long Beach Animal Shelter dataset (TidyTuesday week 2025-03-04) captures 29,787 intake and outcome records from 2021–2025, sourced from the City of Long Beach Animal Care Services open data portal. It includes 22 fields such as `intake_date`, `outcome_date`, `intake_condition`, `animal_type`, `outcome_type`, `dob`, and geolocation, providing a rich mix of categorical, date, and numeric variables.

This project visualizes which intake scenarios and animal characteristics predict different outcomes, and how quickly animals find homes over time. By looking at a variety of visualizations, we hope to provide insight into how intake conditions and animal types affect the animal's outcome and how species and intake conditions influenced the time to adoption. This information could deliver actionable insights for shelter staff on resource allocation and policy planning.

## Data Loading and Cleaning

Load the Longbeach dataset from TidyTuesday

```{r}
longbeach <- tt_load("2025-03-04")
longbeach = longbeach$longbeach
```

Before diving into our analyses, we perform several key data‐wrangling steps to ensure consistency and create the variables we need. First, we standardize the `intake_condition` text by trimming extra whitespace, replacing slashes with spaces, and converting to lowercase. Next, we collapse the many values of `animal_type` into a three-level factor—Dog, Cat, and Other—so we can directly compare these groups. We also calculate each animal’s age at intake (in years) from its date of birth, flagging missing values as “Unknown.” Finally, we derive `days_to_adoption` by subtracting `intake_date` from `outcome_date`, which sets us up to explore adoption timelines.

```{r}
longbeach_clean <- longbeach |>
  
  # standardize intake_condition
  mutate(
    intake_condition = intake_condition |>
      str_squish()             # collapse multiple spaces
      |> str_replace_all("/", " ")  # replace slashes with spaces
      |> str_to_lower()             # convert to lowercase
  ) |>
  
  # create a simplified species_group
  mutate(
    species_group = case_when(
      animal_type == "dog" ~ "Dog",
      animal_type == "cat" ~ "Cat",
      TRUE ~ "Other"
    ) |> 
      factor(levels = c("Dog", "Cat", "Other"))
  ) |>
  
  # compute age_at_intake and flag unknowns
  mutate(
    age_at_intake = as.numeric(intake_date - dob) / 365,
    age_unknown   = is.na(age_at_intake)
  ) |>
  
  # compute days_to_adoption
  mutate(
    days_to_adoption = as.integer(outcome_date - intake_date)
  )
```

#### Analysis of Data

To establish the rationale for combining `animal_type` into Dog, Cat, and Other, horizontal bar chart of the various values of `animal_type` are shown with colot highlighting the grouping.

```{r}
longbeach_clean |>
  count(animal_type, species_group, sort = TRUE) |>
  ggplot(aes(x = n, y = reorder(animal_type, n), fill = species_group)) +
    geom_col() +
    geom_text(aes(label = n),
              hjust = -0.1,
              size = 3) +
    scale_x_continuous(
      expand = expansion(mult = c(0, 0.05)),
      labels = scales::comma_format()
    ) +
    labs(
      title = "Animal Intakes by Type (Dog, Cat, Other)",
      subtitle = "Shelter intakes, 2017–2024",
      x = "Number of Intakes",
      y  = "Animal Type",
      fill = "Species Group",
      caption = "Source: City of Long Beach Animal Care Services (TidyTuesday 2025-03-04)"
    ) +
    scale_fill_discrete(
      breaks = c("Cat", "Dog", "Other")
    ) +
    theme_minimal() +
    theme(
      plot.title.position = "plot",
      plot.title = element_text(face = "bold", hjust = 0.1, size = 12),
      plot.subtitle = element_text(hjust = 0.07, size = 10),
      axis.text = element_text(size = 10),
      plot.caption = element_text(margin = margin(t = 13)),
      legend.position = "inside",
      legend.position.inside = c(0.9, 0.5),
      legend.background = element_rect(fill = "white")
    )

```

## Question 1: How do intake conditions and animal types affect the animal's outcome?

### Introduction:

Animal shelters frequently intake a wide range of animals with different conditions. From scenarios such as healthy surrenders, injured or ill, or stray pickups. Understanding how these intake conditions affect the final outcomes across the three categorized animal types (dogs, cats, and others) is crucial. This analysis provides insights into which species may be underrepresented or disproportionately affected, helping shelter management and policymakers make informed decisions to improve animal care and resource allocation.

### Approach (1-2 paragraphs):

We will analyze how `intake_condition` and `animal_type` affect the likelihood of different outcomes for animals in a shelter. To simplify interpretation and capture broad patterns, `animal_type` has been recoded into a species_group with three categories: dogs, cats, and others. Initially, all 19 unique `outcome_type` values will be explored, based on their distribution, we further categorize outcomes into three groups `outcome_category`: death, non-death, and adopted.


### Analysis (2-3 code blocks, 2 figures, text/code comments as needed):


```{r}

longbeach_clean |>
  mutate(outcome_category = case_when(
    outcome_type %in% c("adoption", "foster to adopt", 
                        "homefirst") ~ "adopted",
    outcome_type %in% c("euthanasia", "died", 
                        "disposal") ~ "death",
    outcome_type %in% c("rescue", "transfer", 
                        "return to owner", "shelter, neuter, return", 
                        "return to rescue", "transport", 
                        "community cat", "return to wild habitat", 
                        "foster", "trap, neuter, release", 
                        "missing", "NA", 
                        "duplicate") ~ "non-death",
    TRUE ~ "non-death"
  )) |>
  group_by(species_group, outcome_category) |>
  summarise(n = n(), .groups = "drop") |>
  group_by(species_group) |>
  mutate(prop = n / sum(n)) |>
  ggplot(aes(x = species_group, y = prop, fill = outcome_category)) +
  geom_col(position = "dodge", color = "white") +
  scale_y_continuous(labels = percent_format()) +
  labs(
    title = "Proportion of Outcomes by Animal Type",
    y = "Proportion of Outcomes",
    x = NULL,
    fill = "Outcome Category"
  ) +
  theme_minimal()


```

```{r}

# Select top 5 intake conditions by count for each outcome category
top_5_intake <- longbeach_clean |>
  mutate(outcome_category = case_when(
    outcome_type %in% c("adoption", "foster to adopt", 
                        "homefirst") ~ "adopted",
    outcome_type %in% c("euthanasia", "died", 
                        "disposal") ~ "death",
    outcome_type %in% c("rescue", "transfer", 
                        "return to owner", "shelter, neuter, return", 
                        "return to rescue", "transport", 
                        "community cat", "return to wild habitat", 
                        "foster", "trap, neuter, release", 
                        "missing", "NA", 
                        "duplicate") ~ "non-death",
    TRUE ~ "non-death"
  )) |>
  filter(!is.na(intake_condition)) |>
  group_by(outcome_category, intake_condition) |>
  summarise(n = n(), .groups = "drop") |>
  group_by(outcome_category) |>
  slice_max(n, n = 5)

ggplot(top_5_intake, 
       aes(x = reorder(intake_condition, n), y = n, fill = intake_condition)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ outcome_category, 
             scales = "free_y") +
  coord_flip() +
  scale_fill_brewer(palette = "Dark2") +
  labs(
    title = "Top 5 Intake Conditions by Outcome Category",
    x = "Intake Condition",
    y = "Count"
  ) +
  theme_minimal()

```


### Discussion (1-3 paragraphs):



## Question 2: How Have Adoption Timelines Evolved (2021–2025)?

### Introduction:

Tracking changes in adoption timelines from 2021 to 2025 is important for shelter capacity planning and improving animal welfare, since faster adoptions free up space and resources for incoming intakes. Examining these trends by species and intake condition also lets us evaluate the impact of recent outreach and medical initiatives and guide future program investments.

### Approach:

**Plot 1** is a line chart of median days_to_adoption over intake_year, with separate lines colored by intake_condition and facets for each species_group. Line charts display trends over time and allow comparison across multiple conditions in a single view.

**Plot 2** is a violin plot that shows the full distribution of days_to_adoption for each year, with fill mapped to intake_condition and facets by species_group. Violin plots show how the shape and range of adoption delays shift over the 2021–2025 period. This informs us whether shelter practices have reduced long‐stay outliers.

### Analysis:

```{r}
adopt_df <- longbeach_clean |>
  filter(outcome_type == "adoption", !is.na(days_to_adoption)) |>
  mutate(intake_year = year(intake_date))
```

#### Plot 1

#### Plot 2

```{r}
#| fig-width: 10
#| fig-height: 7
library(dplyr)
library(lubridate)
library(ggplot2)
library(scales)

# 1. Filter to adoptions and derive intake_year
adopt_df <- longbeach_clean |>
  filter(outcome_type == "adoption", !is.na(days_to_adoption)) |>
  mutate(intake_year = year(intake_date))

# 2. Identify the top 3 intake conditions by total adoptions
top3_conditions <- adopt_df |>
  count(intake_condition, sort = TRUE) |>
  slice_head(n = 3) |>
  pull(intake_condition)

# 3. Group all other conditions into "Other" and compute median days to adoption
adopt_cond_ts <- adopt_df |>
  mutate(
    intake_cond2 = if_else(intake_condition %in% top3_conditions,
                           intake_condition,
                           "Other")
  ) |>
  group_by(species_group, intake_year, intake_cond2) |>
  summarise(
    median_days = median(days_to_adoption, na.rm = TRUE),
    .groups     = "drop"
  ) |>
  filter(intake_year >= 2017 & intake_year <= 2024)

# 4. Plot vertical facets (Dog/Cat/Other) of median days to adoption over time
ggplot(adopt_cond_ts, aes(x = intake_year, y = median_days, color = intake_cond2)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  facet_wrap(~ species_group, ncol = 1, scales = "free_y") +
  scale_x_continuous(breaks = 2017:2024) +
  scale_y_continuous(name = "Median Days to Adoption") +
  scale_color_brewer(palette = "Set2", name = "Intake Condition") +
  labs(
    title    = "Median Time to Adoption by Intake Condition and Species Group",
    subtitle = "Top 3 Intake Conditions vs. Other, 2017–2024",
    x        = "Intake Year"
  ) +
  theme_minimal() +
  theme(
    plot.title.position  = "plot",
    plot.title           = element_text(face = "bold", hjust = 0.1),
    plot.subtitle        = element_text(hjust = 0.1),
    legend.position      = "bottom",
    axis.title.x         = element_text(margin = margin(t = 8)),
    axis.text            = element_text(size = 10)
  )

```

```{r}
#| fig-width: 10
#| fig-height: 7
library(dplyr)
library(lubridate)
library(ggplot2)
library(scales)

# 1. Prepare adoption data for 2017–2024
adopt_df_full <- longbeach_clean |>
  filter(outcome_type == "adoption", !is.na(days_to_adoption)) |>
  mutate(intake_year = year(intake_date)) |>
  filter(intake_year >= 2017, intake_year <= 2024)

# 2. Compute the 95th percentile of days_to_adoption
p95 <- quantile(adopt_df_full$days_to_adoption, 0.95, na.rm = TRUE)

# 3. Violin plot of adoption delays by year, faceted by species_group,
#    zoomed to the 95th percentile to focus on the main distribution
ggplot(adopt_df_full, aes(x = factor(intake_year), y = days_to_adoption)) +
  geom_violin(trim = FALSE, fill = "skyblue", color = NA, alpha = 0.7) +
  stat_summary(fun = median, geom = "point", size = 2, color = "darkblue") +
  facet_wrap(~ species_group, ncol = 1, scales = "free_y") +
  scale_y_continuous("Days to Adoption", labels = comma_format()) +
  scale_x_discrete(drop = FALSE) +
  coord_cartesian(ylim = c(0, p95)) +
  labs(
    title    = "Distribution of Adoption Delays by Year and Species Group",
    subtitle = "Zoomed to 95th percentile, All intake conditions, 2017–2024",
    x        = "Intake Year"
  ) +
  theme_minimal() +
  theme(
    plot.title.position = "plot",
    plot.title          = element_text(face = "bold", hjust = 0.1),
    plot.subtitle       = element_text(hjust = 0.1),
    axis.text           = element_text(size = 10),
    axis.title.x        = element_text(margin = margin(t = 8))
  )

```

### Discussion (1-3 paragraphs):
